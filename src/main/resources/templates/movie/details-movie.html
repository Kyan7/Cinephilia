<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <th:block th:include="~{fragments/head}"></th:block>
</head>
<body>
<th:block th:include="~{fragments/navbar}"></th:block>
<main>
    <div class="jumbotron-fluid cinephilia-dark cinephilia-main-block">
        <div>
            <div class="row">
                <div class="col-md-4">
                    <img class="push-up" th:src="${movie.imageUrl}" width="100%" alt="Movie Poster" align="left">
                    <th:block th:each="trailerId : ${trailerIds}">
                        <iframe allowfullscreen="allowfullscreen" class="push-up push-down" width="100%"
                                th:src="'https://www.youtube.com/embed/' + ${trailerId}" align="left">
                        </iframe>
                    </th:block>
                </div>
                <div class="col-md-8">
                    <th:block th:if="${#lists.contains(currentUser.authorities, 'ROLE_ADMIN')}">
                        <br />
                        <div class="row">
                            <div class="col-md-10"></div>
                            <div class="col-md-2">
                                <div class="row">
                                    <a class="push-left" th:href="@{/movies/edit/{id} (id=${movie.id})}">
                                        <button class="btn btn-dark cinephilia-button">EDIT</button>
                                    </a>
                                    <form class="push-right" th:action="@{/movies/delete/{id}(id=${movie.id})}" th:method="post">
                                        <button class="btn btn-dark cinephilia-remove-button text-right">X</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <small class="cinephilia-orange-text" th:text="'Creator: ' + ${movie.user}"></small>
                    </th:block>
                    <br />
                    <small class="cinephilia-orange-text" th:text="${movie.views} + ' View(s)'"></small>
                    <div class="row">
                        <div class="col-md-11">
                            <div class="cinephilia-title-text" th:text="${movie.title}"></div>
                            <hr />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" align="left">
                            <div class="cinephilia-small-text cinephilia-orange-text">Genres: </div><div class="cinephilia-small-text" th:text="${#strings.listJoin(movie.genres, ', ')}"></div>
                            <div class="cinephilia-small-text cinephilia-orange-text">Runtime: </div><div class="cinephilia-small-text" th:text="${movie.runtime} + ' mins'"></div>
                            <div class="cinephilia-small-text cinephilia-orange-text">Studio(s): </div><div class="cinephilia-small-text" th:text="${movie.studios}"></div>
                            <div class="cinephilia-small-text cinephilia-orange-text">Director(s): </div><div class="cinephilia-small-text" th:text="${movie.directors}"></div>
                            <div class="cinephilia-small-text cinephilia-orange-text">Lead Actor: </div><div class="cinephilia-small-text" th:text="${movie.leadActor}"></div>
                            <div class="cinephilia-small-text cinephilia-orange-text">Supporting Actor(s): </div><div class="cinephilia-small-text" th:text="${movie.supportingActors}"></div>
                        </div>
                        <div class="col-md-6" align="right">
                            <div class="cinephilia-small-text cinephilia-orange-text">IMDB Rating: </div><div class="cinephilia-small-text" th:text="${movie.imdbRating}"></div>
                            <div class="cinephilia-small-text cinephilia-orange-text">Rotten Tomatoes: </div><div class="cinephilia-small-text" th:text="${movie.rottenTomatoesPercent + '%'}"></div>
                            <th:block th:if="${movie.budget} >= 1000">
                                <div class="cinephilia-small-text cinephilia-orange-text">Budget: </div><div class="cinephilia-small-text" th:text="${movie.budget}/1000 + ' billion'"></div>
                            </th:block>
                            <th:block th:if="${movie.budget} < 1000">
                                <div class="cinephilia-small-text cinephilia-orange-text">Budget: </div><div class="cinephilia-small-text" th:text="${movie.budget} + ' million'"></div>
                            </th:block>
                            <th:block th:if="${movie.boxOffice} >= 1000">
                                <div class="cinephilia-small-text cinephilia-orange-text">Box Office: </div><div class="cinephilia-small-text" th:text="${movie.boxOffice}/1000 + ' billion'"></div>
                            </th:block>
                            <th:block th:if="${movie.boxOffice} < 1000">
                                <div class="cinephilia-small-text cinephilia-orange-text">Box Office: </div><div class="cinephilia-small-text" th:text="${movie.boxOffice} + ' million'"></div>
                            </th:block>
                            <div class="cinephilia-small-text cinephilia-orange-text">Average user rating: </div><div class="cinephilia-small-text" th:text="${averageUserRating}"></div>
                            <div class="cinephilia-small-text cinephilia-orange-text">Release Date: </div><div class="cinephilia-small-text" th:text="${movie.releaseDate}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-11">
                            <hr />
                            <div class="cinephilia-small-text cinephilia-orange-text">Description: </div><div class="cinephilia-small-text" th:text="${movie.description}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-11">
                            <br />
                            <br />
                            <br />
                            <hr />
                            <div class="jumbotron-fluid cinephilia-review-post-block">
                                <form th:action="@{/movies/add-review/{id} (id=${movie.id})}" th:method="post">
                                    <div class="form-group tiny-margin-top-bottom">
                                        <label class="cinephilia-orange-text cinephilia-tiny-text" for="title">Review title</label>
                                        <input type="text" class="form-control" id="title" placeholder="Review title" name="title">
                                    </div>
                                    <div class="form-group tiny-margin-top-bottom">
                                        <label class="cinephilia-orange-text cinephilia-tiny-text" for="rating">Rating</label>
                                        <input type="number" step="0.5" min="0" max="10" class="form-control" id="rating" placeholder="0" name="rating">
                                    </div>
                                    <div class="form-group tiny-margin-top-bottom">
                                        <label class="cinephilia-orange-text cinephilia-tiny-text" for="description">Description</label>
                                        <textarea rows="5" class="form-control" id="description" placeholder="Description" name="description"></textarea>
                                    </div>
                                    <button class="btn btn-dark cinephilia-button text-right push-down">Submit</button>
                                </form>
                            </div>
                            <th:block th:each="review : ${reviews}">
                                <th:block th:if="${review.reviewer.equals(currentUser.username)}">
                                    <div class="jumbotron-fluid cinephilia-current-user-review-block">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="cinephilia-small-text cinephilia-orange-text">Title: </div><div class="cinephilia-small-text" th:text="${review.title}"></div>
                                                <div class="cinephilia-small-text cinephilia-orange-text">Rating: </div><div class="cinephilia-small-text" th:text="${review.rating}"></div>
                                                <th:block th:if="${#lists.contains(currentUser.authorities, 'ROLE_ADMIN')}">
                                                    <form th:action="@{/movies/delete-review/{movieId}/{reviewId}(movieId=${movie.id},reviewId=${review.id})}" th:method="post">
                                                        <button class="btn btn-dark cinephilia-remove-button">X</button>
                                                    </form>
                                                </th:block>
                                            </div>
                                            <div class="col-md-7">
                                                <div class="cinephilia-small-text cinephilia-orange-text">Description: </div><div class="cinephilia-small-text" th:text="${review.description}"></div>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                                <th:block th:if="${!review.reviewer.equals(currentUser.username)}">
                                    <div class="jumbotron-fluid cinephilia-review-block">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="cinephilia-small-text cinephilia-orange-text">Title: </div><div class="cinephilia-small-text" th:text="${review.title}"></div>
                                                <div class="cinephilia-small-text cinephilia-orange-text">Rating: </div><div class="cinephilia-small-text" th:text="${review.rating}"></div>
                                                <th:block th:if="${#lists.contains(currentUser.authorities, 'ROLE_ADMIN')}">
                                                    <form th:action="@{/movies/delete-review/{movieId}/{reviewId}(movieId=${movie.id},reviewId=${review.id})}" th:method="post">
                                                        <button class="btn btn-dark cinephilia-remove-button">X</button>
                                                    </form>
                                                </th:block>
                                            </div>
                                            <div class="col-md-7">
                                                <div class="cinephilia-small-text cinephilia-orange-text">Description: </div><div class="cinephilia-small-text" th:text="${review.description}"></div>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</main>
<th:block th:include="~{fragments/footer}"></th:block>
</body>
</html>